!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("three-spatial-viewer"),require("three")):"function"==typeof define&&define.amd?define(["exports","three-spatial-viewer","three"],i):i((e=e||self).CryptoGawd={},e.SpatialViewer,e.THREE)}(this,(function(e,i,t){"use strict";function n(e,i,t,n,s,r,o){try{var a=e[r](o),u=a.value}catch(e){return void t(e)}a.done?i(u):Promise.resolve(u).then(n,s)}var s=function(){for(var e=0,i=0,t=arguments.length;i<t;i++)e+=arguments[i].length;var n=Array(e),s=0;for(i=0;i<t;i++)for(var r=arguments[i],o=0,a=r.length;o<a;o++,s++)n[s]=r[o];return n},r=function(e,i,t){this.name=e,this.version=i,this.os=t,this.type="browser"},o=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},a=function(e,i,t,n){this.name=e,this.version=i,this.os=t,this.bot=n,this.type="bot-device"},u=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},l=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},h=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,d=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],c=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function p(e){return e?w(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new l:"undefined"!=typeof navigator?w(navigator.userAgent):"undefined"!=typeof process&&process.version?new o(process.version.slice(1)):null}function w(e){var i=function(e){return""!==e&&d.reduce((function(i,t){var n=t[0],s=t[1];if(i)return i;var r=s.exec(e);return!!r&&[n,r]}),!1)}(e);if(!i)return null;var t=i[0],n=i[1];if("searchbot"===t)return new u;var o=n[1]&&n[1].split(/[._]/).slice(0,3);o?o.length<3&&(o=s(o,function(e){for(var i=[],t=0;t<e;t++)i.push("0");return i}(3-o.length))):o=[];var l=o.join("."),p=function(e){for(var i=0,t=c.length;i<t;i++){var n=c[i],s=n[0];if(n[1].exec(e))return s}return null}(e),w=h.exec(e);return w&&w[1]?new a(t,l,p,w[1]):new r(t,l,p)}class v{constructor(){this.url=void 0,this.container=void 0,this.enableVideo=!0,this.enableMouseMove=!0,this.spatialProps=new i.Props}}e.Gawd=class{constructor(){this.name=void 0,this.assets=void 0}},e.GawdAsset=class{constructor(){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0}},e.GawdQuilt=class{constructor(){this.columns=void 0,this.rows=void 0}},e.Player=class{constructor(e){var n=this;this.props=new v,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.EasingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},this.props.spatialProps.spatialType=i.SpatialType.LOOKING_GLASS,this.props.spatialProps.stereoMode=i.StereoMode.OFF,this.setProps(this.props,e),this.clock=new t.Clock,this.props.container?(this.initThree(),this.props.url&&this.loadGawdConfig(this.props.url).then((function(e){n.initGawd(e)}))):console.warn("No container was set")}setProps(e,i){if(i)for(var t in i)t in e?e[t]=i[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var e=this;this.scene=new t.Scene,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.props.container.clientWidth,this.props.container.clientHeight),this.renderer.xr.enabled=!1,this.props.container.appendChild(this.renderer.domElement),this.camera=new t.PerspectiveCamera(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){e.render()})),window.addEventListener("resize",(function(i){e.camera.aspect=e.aspectRatio,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.props.container.clientWidth,e.props.container.clientHeight)})),this.props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}initGawd(e){var i;p();i=e.assets.filter((function(e){return"lookingglass"==e.spatial&&"FourKSquare"==e.quiltType&&"image/png"==e.contentType}))[0],this.initMedia(i)}initMedia(e){if("image/png"==e.contentType)(new t.TextureLoader).load(e.url,function(i){this.loadSpatialPlayer(i,e)}.bind(this));else if("video/mp4"==e.contentType){var i=document.createElement("video");i.src=e.url,i.crossOrigin="anonymous",i.muted=!0,i.autoplay=!0,i.loop=!0,i.playsInline=!0,i.style.display="none",document.body.appendChild(i),i.play();var n=new t.VideoTexture(i);this.loadSpatialPlayer(n,e)}}loadSpatialPlayer(e,t){var n=new i.QuiltConfig;n.columns=t.quilt.columns>0?t.quilt.columns:8,n.rows=t.quilt.rows>0?t.quilt.rows:6,n.width=t.viewSize.width>0?t.viewSize.width:480,n.height=t.viewSize.height>0?t.viewSize.height:640,this.props.spatialProps.quilt=n,this.spatialPlayer=new i.Player(e,null,this.props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.scene.add(this.spatialPlayer);var s=this.camera.position.z-this.spatialPlayer.position.z,r=this.aspectRatio;this.camera.fov=Math.atan(r/s)*(180/Math.PI),this.camera.updateProjectionMatrix()}loadGawdConfig(e){return(i=function*(){var i=yield fetch(e);return yield i.json()},function(){var e=this,t=arguments;return new Promise((function(s,r){var o=i.apply(e,t);function a(e){n(o,s,r,a,u,"next",e)}function u(e){n(o,s,r,a,u,"throw",e)}a(void 0)}))})();var i}onMouseMove(e){this.spatialPlayer&&(this.targetAngle=(1-e.clientX/window.innerWidth)*this.totalAngles,this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){this.aniCurTime+=this.clock.getDelta(),this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration)))),this.renderer.render(this.scene,this.camera)}lerp(e,i,t){return e+(i-e)*(t=(t=t<0?0:t)>1?1:t)}get aspectRatio(){return this.props.container.clientWidth/this.props.container.clientHeight}},e.PlayerProps=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gawd-player.min.js.map
