!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("three-spatial-viewer"),require("three")):"function"==typeof define&&define.amd?define(["exports","three-spatial-viewer","three"],i):i((e=e||self).CryptoGawd={},e.SpatialViewer,e.THREE)}(this,(function(e,i,t){"use strict";function s(e,i,t,s,n,o,r){try{var a=e[o](r),l=a.value}catch(e){return void t(e)}a.done?i(l):Promise.resolve(l).then(s,n)}var n=function(){for(var e=0,i=0,t=arguments.length;i<t;i++)e+=arguments[i].length;var s=Array(e),n=0;for(i=0;i<t;i++)for(var o=arguments[i],r=0,a=o.length;r<a;r++,n++)s[n]=o[r];return s},o=function(e,i,t){this.name=e,this.version=i,this.os=t,this.type="browser"},r=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},a=function(e,i,t,s){this.name=e,this.version=i,this.os=t,this.bot=s,this.type="bot-device"},l=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},u=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},d=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,h=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],p=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function c(e){return e?w(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new u:"undefined"!=typeof navigator?w(navigator.userAgent):"undefined"!=typeof process&&process.version?new r(process.version.slice(1)):null}function w(e){var i=function(e){return""!==e&&h.reduce((function(i,t){var s=t[0],n=t[1];if(i)return i;var o=n.exec(e);return!!o&&[s,o]}),!1)}(e);if(!i)return null;var t=i[0],s=i[1];if("searchbot"===t)return new l;var r=s[1]&&s[1].split(/[._]/).slice(0,3);r?r.length<3&&(r=n(r,function(e){for(var i=[],t=0;t<e;t++)i.push("0");return i}(3-r.length))):r=[];var u=r.join("."),c=function(e){for(var i=0,t=p.length;i<t;i++){var s=p[i],n=s[0];if(s[1].exec(e))return n}return null}(e),w=d.exec(e);return w&&w[1]?new a(t,u,c,w[1]):new o(t,u,c)}class f{constructor(){this.url=void 0,this.container=void 0,this.enableMouseMove=!0,this.defaultAsset=new v,this.defaultMobileAsset=new v,this.spatialProps=new i.Props}}class v{constructor(){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0}}class m{constructor(){this.width=void 0,this.height=void 0}}e.Gawd=class{constructor(){this.name=void 0,this.hash=void 0,this.assets=void 0}},e.GawdAsset=v,e.GawdQuilt=class{constructor(){this.columns=void 0,this.rows=void 0}},e.Player=class{constructor(e){var s=this;this._props=new f,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.gawd=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.EasingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},this._props.spatialProps.spatialType=i.SpatialType.LOOKING_GLASS,this._props.spatialProps.stereoMode=i.StereoMode.OFF,this._props.defaultAsset.spatial="lookingglass",this._props.defaultAsset.quiltType="FourKSquare",this._props.defaultAsset.size=new m,this._props.defaultAsset.size.width=4320,this._props.defaultAsset.contentType="image/png",this._props.defaultMobileAsset.spatial="2d",this._props.defaultMobileAsset.size=new m,this._props.defaultMobileAsset.size.width=1080,this._props.defaultMobileAsset.contentType="video/mp4",this.setProps(this._props,e),this.clock=new t.Clock,this._props.container?(this.initThree(),this._props.url&&this.loadGawdConfig(this._props.url).then((function(e){s.initGawd(e)}))):console.warn("No container was set")}setProps(e,i){if(i)for(var t in i)t in e?e[t]=i[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var e=this;this.scene=new t.Scene,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.setSize(this._props.container.clientWidth,this._props.container.clientHeight),this.renderer.xr.enabled=!1,this._props.container.appendChild(this.renderer.domElement),this.camera=new t.PerspectiveCamera(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){e.render()})),window.addEventListener("resize",(function(i){e.camera.aspect=e.aspectRatio,e.camera.updateProjectionMatrix(),e.renderer.setSize(e._props.container.clientWidth,e._props.container.clientHeight)}))}initGawd(e){var i=this;this.gawd=e;var t=null;c().os.match(/iOS|android/i)&&(t=e.assets.filter((function(e){return e.spatial==i._props.defaultMobileAsset.spatial&&e.size.width==i._props.defaultMobileAsset.size.width&&(e.quiltType==i._props.defaultMobileAsset.quiltType||!i._props.defaultMobileAsset.quiltType)&&e.contentType==i._props.defaultMobileAsset.contentType}))[0])||(t=e.assets.filter((function(e){return e.spatial==i._props.defaultAsset.spatial&&e.size.width==i._props.defaultAsset.size.width&&(e.quiltType==i._props.defaultAsset.quiltType||!i._props.defaultAsset.quiltType)&&e.contentType==i._props.defaultAsset.contentType}))[0]),this.initMedia(t)}initMedia(e){if(e){if("image/png"==e.contentType)(new t.TextureLoader).load(e.url,function(i){this.loadSpatialPlayer(i,e)}.bind(this));else if("video/mp4"==e.contentType){var i="gawd-video-"+this.gawd.hash,s=document.getElementById(i);s||((s=document.createElement("video")).id=i,s.src=e.url,s.crossOrigin="anonymous",s.muted=!0,s.autoplay=!0,s.loop=!0,s.playsInline=!0,s.style.display="none",document.body.appendChild(s),s.play());var n=new t.VideoTexture(s);this.loadSpatialPlayer(n,e)}}else console.warn("No GawdAsset found!")}loadSpatialPlayer(e,t){var s=new i.QuiltConfig;t.quilt?(s.columns=t.quilt.columns>0?t.quilt.columns:8,s.rows=t.quilt.rows>0?t.quilt.rows:6,s.width=t.viewSize.width>0?t.viewSize.width:480,s.height=t.viewSize.height>0?t.viewSize.height:640):(s.columns=1,s.rows=1,s.width=t.size.width,s.height=t.size.height,this._props.enableMouseMove=!1),this._props.spatialProps.quilt=s,this.spatialPlayer=new i.Player(e,null,this._props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.scene.add(this.spatialPlayer);var n=this.camera.position.z-this.spatialPlayer.position.z,o=this.aspectRatio;this.camera.fov=Math.atan(o/n)*(180/Math.PI),this.camera.updateProjectionMatrix(),this._props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}loadGawdConfig(e){return(i=function*(){var i=yield fetch(e);return yield i.json()},function(){var e=this,t=arguments;return new Promise((function(n,o){var r=i.apply(e,t);function a(e){s(r,n,o,a,l,"next",e)}function l(e){s(r,n,o,a,l,"throw",e)}a(void 0)}))})();var i}onMouseMove(e){this.spatialPlayer&&(this.targetAngle=(1-e.clientX/window.innerWidth)*(this.totalAngles-1),this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){this._props.enableMouseMove&&(this.aniCurTime+=this.clock.getDelta(),this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration))))),this.renderer.render(this.scene,this.camera)}lerp(e,i,t){return e+(i-e)*(t=(t=t<0?0:t)>1?1:t)}get aspectRatio(){return this._props.container.clientWidth/this._props.container.clientHeight}get props(){return this._props}},e.PlayerProps=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gawd-player.min.js.map
