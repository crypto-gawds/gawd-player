define(["exports","three-spatial-viewer","three"],(function(i,e,t){"use strict";function s(i,e,t,s,n,o,r){try{var a=i[o](r),h=a.value}catch(i){return void t(i)}a.done?e(h):Promise.resolve(h).then(s,n)}var n=function(i,e,t){if(t||2===arguments.length)for(var s,n=0,o=e.length;n<o;n++)!s&&n in e||(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return i.concat(s||Array.prototype.slice.call(e))},o=function(i,e,t){this.name=i,this.version=e,this.os=t,this.type="browser"},r=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},a=function(i,e,t,s){this.name=i,this.version=e,this.os=t,this.bot=s,this.type="bot-device"},h=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},l=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},d=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,u=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],p=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function c(i){return i?v(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new l:"undefined"!=typeof navigator?v(navigator.userAgent):"undefined"!=typeof process&&process.version?new r(process.version.slice(1)):null}function v(i){var e=function(i){return""!==i&&u.reduce((function(e,t){var s=t[0],n=t[1];if(e)return e;var o=n.exec(i);return!!o&&[s,o]}),!1)}(i);if(!e)return null;var t=e[0],s=e[1];if("searchbot"===t)return new h;var r=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);r?r.length<3&&(r=n(n([],r,!0),function(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}(3-r.length),!0)):r=[];var l=r.join("."),c=function(i){for(var e=0,t=p.length;e<t;e++){var s=p[e],n=s[0];if(s[1].exec(i))return n}return null}(i),v=d.exec(i);return v&&v[1]?new a(t,l,c,v[1]):new o(t,l,c)}class m{constructor(){this.url=void 0,this.container=void 0,this.enableMouseMove=!0,this.toggleModes=!1,this.defaultThumbnailSize=640,this.defaultAsset=new w({spatial:"lookingglass",quiltType:"FourKSquare",size:new y({width:4320}),contentType:"image/png"}),this.defaultMobileAsset=new w({spatial:"2d",size:new y({width:1080}),contentType:"video/mp4"}),this.animationAsset=new w({spatial:"2d",size:new y({width:1080}),contentType:"video/mp4"}),this.spatialProps={spatialType:e.SpatialType.LOOKING_GLASS,stereoMode:e.StereoMode.OFF,quilt:null},this.gawdData=void 0}}class w{constructor(i){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0,Object.assign(this,i)}}class y{constructor(i){this.width=void 0,this.height=void 0,Object.assign(this,i)}}i.Gawd=class{constructor(i){this.name=void 0,this.hash=void 0,this.assets=void 0,Object.assign(this,i)}},i.GawdAsset=w,i.GawdQuilt=class{constructor(i){this.columns=void 0,this.rows=void 0,Object.assign(this,i)}},i.Player=class{constructor(i){var e=this;this._props=new m,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.gawd=void 0,this.video=void 0,this.thumbnail=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.hideThumbnail=!1,this.thumbCurTime=0,this.EasingFunctions={linear:function(i){return i},easeInQuad:function(i){return i*i},easeOutQuad:function(i){return i*(2-i)},easeInOutQuad:function(i){return i<.5?2*i*i:(4-2*i)*i-1},easeInCubic:function(i){return i*i*i},easeOutCubic:function(i){return--i*i*i+1},easeInOutCubic:function(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1},easeInQuart:function(i){return i*i*i*i},easeOutQuart:function(i){return 1- --i*i*i*i},easeInOutQuart:function(i){return i<.5?8*i*i*i*i:1-8*--i*i*i*i},easeInQuint:function(i){return i*i*i*i*i},easeOutQuint:function(i){return 1+--i*i*i*i*i},easeInOutQuint:function(i){return i<.5?16*i*i*i*i*i:1+16*--i*i*i*i*i}},this.setProps(this._props,i),this.clock=new t.Clock,this._props.container?this._props.gawdData&&this._props.gawdData.assets&&this._props.gawdData.assets.length>0?this.initGawd(this._props.gawdData):this._props.url&&this.loadGawdConfig(this._props.url).then((function(i){e.initGawd(i)})):console.warn("No container was set")}setProps(i,e){if(e)for(var t in e)t in i?i[t]=e[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var i=this;this.scene||(this.scene=new t.Scene,this.renderer=new t.WebGLRenderer({antialias:!0}),this.renderer.xr.enabled=!1,this._props.container.appendChild(this.renderer.domElement),this.camera=new t.PerspectiveCamera(90,this.aspectRatio,.01,1e3),this.camera.position.z=10,this.scene.add(this.camera),this.resize(),this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",this.resize.bind(this)),this._props.toggleModes&&this._props.container.addEventListener("click",this.toggleDisplayMode.bind(this)))}resize(){this.camera.aspect=this.aspectRatio,this.camera.updateProjectionMatrix(),this.renderer.setSize(this._props.container.clientWidth,this._props.container.clientHeight)}isMobile(){return null!=c().os.match(/iOS|android/i)}initGawd(i){var e=this;this.gawd=i;var t=null;this.isMobile()&&(t=i.assets.filter((function(i){return i.spatial==e._props.defaultMobileAsset.spatial&&i.size.width==e._props.defaultMobileAsset.size.width&&(i.quiltType==e._props.defaultMobileAsset.quiltType||!e._props.defaultMobileAsset.quiltType)&&i.contentType==e._props.defaultMobileAsset.contentType}))[0]),t||(t=i.assets.filter((function(i){return i.spatial==e._props.defaultAsset.spatial&&i.size.width==e._props.defaultAsset.size.width&&(i.quiltType==e._props.defaultAsset.quiltType||!e._props.defaultAsset.quiltType)&&i.contentType==e._props.defaultAsset.contentType}))[0]),this.initThumbnail(),this.initMedia(t)}initThumbnail(){var i=this,e=this.gawd.assets.sort((function(i,e){return i.size.width-e.size.width})).find((function(e){return"image/png"==e.contentType&&e.size.width>=i._props.defaultThumbnailSize})).url;this.thumbnail=document.createElement("img"),this.thumbnail.src=e,this.thumbnail.crossOrigin="anonymous",this.thumbnail.style.width="100%",this.thumbnail.style.height="100%",this.thumbnail.style.position="absolute",this.thumbnail.style.left="0",this._props.container.appendChild(this.thumbnail)}hideThumb(){this.hideThumbnail=!0,this.thumbCurTime=0}initMedia(i,e){var s=this;i?"image/png"==i.contentType?(new t.TextureLoader).load(i.url,function(t){this.loadSpatialPlayer(t,i),this.hideThumb(),e&&e()}.bind(this)):"video/mp4"==i.contentType&&this.initVideo(i,(function(){var n=new t.VideoTexture(s.video);s.loadSpatialPlayer(n,i),s.hideThumb(),e&&e()})):console.warn("No GawdAsset found!")}initVideo(i,e){var t="gawd-video-"+this.gawd.hash;this.video=document.getElementById(t),this.video||(this.video=document.createElement("video"),this.video.id=t,this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.preload="auto",this.video.autoplay=!0,this.video.loop=!0,this.video.playsInline=!0,this.video.style.width="100%",this.video.style.height="100%",this.video.style.display="none",this.props.container.appendChild(this.video)),e&&(this.video.ontimeupdate=function(){this.video.currentTime>0&&(e(),this.video.ontimeupdate=null,e=null)}.bind(this),this.video.src=i.url,this.video.play())}loadSpatialPlayer(i,t){var s=new e.QuiltConfig;if(this.initThree(),t.quilt){s.columns=t.quilt.columns>0?t.quilt.columns:8,s.rows=t.quilt.rows>0?t.quilt.rows:6,s.width=t.viewSize.width>0?t.viewSize.width:480,s.height=t.viewSize.height>0?t.viewSize.height:640,this._props.spatialProps.quilt=s,this.spatialPlayer=new e.Player(i,null,this._props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.spatialPlayer.quiltAngle=this.targetAngle=this.totalAngles/2,this.scene.add(this.spatialPlayer);var n=this.camera.position.z-this.spatialPlayer.position.z,o=this.aspectRatio;this.camera.fov=Math.atan(o/n)*(180/Math.PI),this.camera.updateProjectionMatrix(),this._props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}else this.video.style.display="",this._props.enableMouseMove=!1}toggleDisplayMode(){this.spatialPlayer?(this.spatialPlayer.quiltStereoEyeDistance=8,this.video&&""==this.video.style.display?(this.video.style.display="none",this.video.pause(),this.renderer.domElement.style.display="",this.spatialPlayer.stereoMode=e.StereoMode.OFF):this.spatialPlayer.stereoMode==e.StereoMode.OFF?this.spatialPlayer.stereoMode=e.StereoMode.COLOR:this.spatialPlayer.stereoMode==e.StereoMode.COLOR&&(this.initVideo(this.getAnimationAsset()),this.renderer.domElement.style.display="none",this.video.style.display="",this.video.play())):(this._props.enableMouseMove=!0,this.initMedia(this.getQuiltPNGAsset(),function(){this.video.style.display="none",this.renderer.domElement.style.display="",this.spatialPlayer.stereoMode=e.StereoMode.OFF}.bind(this)))}getQuiltPNGAsset(){return this.gawd.assets.find((function(i){return"image/png"==i.contentType&&"FourKSquare"==i.quiltType}))}getAnimationAsset(){var i=this;return this.gawd.assets.sort((function(i,e){return e.size.width-i.size.width})).find((function(e){return e.contentType==i._props.animationAsset.contentType&&e.size.width<=i._props.animationAsset.size.width&&e.spatial==i._props.animationAsset.spatial}))}loadGawdConfig(i){return(e=function*(){var e=yield fetch(i);return yield e.json()},function(){var i=this,t=arguments;return new Promise((function(n,o){var r=e.apply(i,t);function a(i){s(r,n,o,a,h,"next",i)}function h(i){s(r,n,o,a,h,"throw",i)}a(void 0)}))})();var e}onMouseMove(i){this.spatialPlayer&&(this.targetAngle=(1-i.clientX/window.innerWidth)*(this.totalAngles-1),this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){var i=this.clock.getDelta();this._props.enableMouseMove&&(this.aniCurTime+=i,this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&"0"==this.thumbnail.style.opacity&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration))))),this.hideThumbnail&&(this.thumbCurTime+=i,this.thumbnail&&"0"!=this.thumbnail.style.opacity&&(this.thumbnail.style.opacity=this.lerp(1,0,this.EasingFunctions.linear(this.thumbCurTime/.25)).toString())),this.scene&&this.renderer.render(this.scene,this.camera)}lerp(i,e,t){return i+(e-i)*(t=(t=t<0?0:t)>1?1:t)}dispose(){this.scene&&this.scene.remove(this.spatialPlayer),this.spatialPlayer&&this.spatialPlayer.dispose(),this.thumbnail&&this.thumbnail.remove(),this.video&&this.video.remove(),this.renderer?.domElement&&this.renderer.domElement.remove(),window.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("resize",this.resize.bind(this))}get aspectRatio(){return this._props.container.clientWidth/this._props.container.clientHeight}get props(){return this._props}},i.PlayerProps=m,Object.defineProperty(i,"__esModule",{value:!0})}));
//# sourceMappingURL=gawd-player.amd.min.js.map
