import{SpatialType as i,StereoMode as e,QuiltConfig as t,Player as n,Props as s}from"three-spatial-viewer";import{Clock as r,Scene as o,WebGLRenderer as a,PerspectiveCamera as h,TextureLoader as u,VideoTexture as l}from"three";function d(i,e,t,n,s,r,o){try{var a=i[r](o),h=a.value}catch(i){return void t(i)}a.done?e(h):Promise.resolve(h).then(n,s)}var c=function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;var n=Array(i),s=0;for(e=0;e<t;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,s++)n[s]=r[o];return n},p=function(i,e,t){this.name=i,this.version=e,this.os=t,this.type="browser"},w=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},v=function(i,e,t,n){this.name=i,this.version=e,this.os=t,this.bot=n,this.type="bot-device"},f=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},m=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},g=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,y=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],b=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function S(i){return i?O(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new m:"undefined"!=typeof navigator?O(navigator.userAgent):"undefined"!=typeof process&&process.version?new w(process.version.slice(1)):null}function O(i){var e=function(i){return""!==i&&y.reduce((function(e,t){var n=t[0],s=t[1];if(e)return e;var r=s.exec(i);return!!r&&[n,r]}),!1)}(i);if(!e)return null;var t=e[0],n=e[1];if("searchbot"===t)return new f;var s=n[1]&&n[1].split(/[._]/).slice(0,3);s?s.length<3&&(s=c(s,function(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}(3-s.length))):s=[];var r=s.join("."),o=function(i){for(var e=0,t=b.length;e<t;e++){var n=b[e],s=n[0];if(n[1].exec(i))return s}return null}(i),a=g.exec(i);return a&&a[1]?new v(t,r,o,a[1]):new p(t,r,o)}class P{constructor(){this.url=void 0,this.container=void 0,this.enableVideo=!0,this.enableMouseMove=!0,this.spatialProps=new s}}class W{constructor(){this.name=void 0,this.assets=void 0}}class M{constructor(){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0}}class A{constructor(){this.columns=void 0,this.rows=void 0}}class T{constructor(t){var n=this;this.props=new P,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.EasingFunctions={linear:function(i){return i},easeInQuad:function(i){return i*i},easeOutQuad:function(i){return i*(2-i)},easeInOutQuad:function(i){return i<.5?2*i*i:(4-2*i)*i-1},easeInCubic:function(i){return i*i*i},easeOutCubic:function(i){return--i*i*i+1},easeInOutCubic:function(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1},easeInQuart:function(i){return i*i*i*i},easeOutQuart:function(i){return 1- --i*i*i*i},easeInOutQuart:function(i){return i<.5?8*i*i*i*i:1-8*--i*i*i*i},easeInQuint:function(i){return i*i*i*i*i},easeOutQuint:function(i){return 1+--i*i*i*i*i},easeInOutQuint:function(i){return i<.5?16*i*i*i*i*i:1+16*--i*i*i*i*i}},this.props.spatialProps.spatialType=i.LOOKING_GLASS,this.props.spatialProps.stereoMode=e.OFF,this.setProps(this.props,t),this.clock=new r,this.props.container?(this.initThree(),this.props.url&&this.loadGawdConfig(this.props.url).then((function(i){n.initGawd(i)}))):console.warn("No container was set")}setProps(i,e){if(e)for(var t in e)t in i?i[t]=e[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var i=this;this.scene=new o,this.renderer=new a({antialias:!0}),this.renderer.setSize(this.props.container.clientWidth,this.props.container.clientHeight),this.renderer.xr.enabled=!1,this.props.container.appendChild(this.renderer.domElement),this.camera=new h(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",(function(e){i.camera.aspect=i.aspectRatio,i.camera.updateProjectionMatrix(),i.renderer.setSize(i.props.container.clientWidth,i.props.container.clientHeight)})),this.props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}initGawd(i){var e;S();e=i.assets.filter((function(i){return"lookingglass"==i.spatial&&"FourKSquare"==i.quiltType&&"image/png"==i.contentType}))[0],this.initMedia(e)}initMedia(i){if("image/png"==i.contentType)(new u).load(i.url,function(e){this.loadSpatialPlayer(e,i)}.bind(this));else if("video/mp4"==i.contentType){var e=document.createElement("video");e.src=i.url,e.crossOrigin="anonymous",e.muted=!0,e.autoplay=!0,e.loop=!0,e.playsInline=!0,e.style.display="none",document.body.appendChild(e),e.play();var t=new l(e);this.loadSpatialPlayer(t,i)}}loadSpatialPlayer(i,e){var s=new t;s.columns=e.quilt.columns>0?e.quilt.columns:8,s.rows=e.quilt.rows>0?e.quilt.rows:6,s.width=e.viewSize.width>0?e.viewSize.width:480,s.height=e.viewSize.height>0?e.viewSize.height:640,this.props.spatialProps.quilt=s,this.spatialPlayer=new n(i,null,this.props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.scene.add(this.spatialPlayer);var r=this.camera.position.z-this.spatialPlayer.position.z,o=this.aspectRatio;this.camera.fov=Math.atan(o/r)*(180/Math.PI),this.camera.updateProjectionMatrix()}loadGawdConfig(i){return(e=function*(){var e=yield fetch(i);return yield e.json()},function(){var i=this,t=arguments;return new Promise((function(n,s){var r=e.apply(i,t);function o(i){d(r,n,s,o,a,"next",i)}function a(i){d(r,n,s,o,a,"throw",i)}o(void 0)}))})();var e}onMouseMove(i){this.spatialPlayer&&(this.targetAngle=(1-i.clientX/window.innerWidth)*this.totalAngles,this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){this.aniCurTime+=this.clock.getDelta(),this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration)))),this.renderer.render(this.scene,this.camera)}lerp(i,e,t){return i+(e-i)*(t=(t=t<0?0:t)>1?1:t)}get aspectRatio(){return this.props.container.clientWidth/this.props.container.clientHeight}}export{W as Gawd,M as GawdAsset,A as GawdQuilt,T as Player,P as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
