import{QuiltConfig as i,Player as e,SpatialType as t,StereoMode as s}from"three-spatial-viewer";import{Clock as n,Scene as o,WebGLRenderer as r,PerspectiveCamera as a,TextureLoader as h,VideoTexture as l}from"three";function d(i,e,t,s,n,o,r){try{var a=i[o](r),h=a.value}catch(i){return void t(i)}a.done?e(h):Promise.resolve(h).then(s,n)}var u=function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;var s=Array(i),n=0;for(e=0;e<t;e++)for(var o=arguments[e],r=0,a=o.length;r<a;r++,n++)s[n]=o[r];return s},p=function(i,e,t){this.name=i,this.version=e,this.os=t,this.type="browser"},c=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},v=function(i,e,t,s){this.name=i,this.version=e,this.os=t,this.bot=s,this.type="bot-device"},w=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},f=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},m=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,g=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],y=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function b(i){return i?O(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new f:"undefined"!=typeof navigator?O(navigator.userAgent):"undefined"!=typeof process&&process.version?new c(process.version.slice(1)):null}function O(i){var e=function(i){return""!==i&&g.reduce((function(e,t){var s=t[0],n=t[1];if(e)return e;var o=n.exec(i);return!!o&&[s,o]}),!1)}(i);if(!e)return null;var t=e[0],s=e[1];if("searchbot"===t)return new w;var n=s[1]&&s[1].split(/[._]/).slice(0,3);n?n.length<3&&(n=u(n,function(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}(3-n.length))):n=[];var o=n.join("."),r=function(i){for(var e=0,t=y.length;e<t;e++){var s=y[e],n=s[0];if(s[1].exec(i))return n}return null}(i),a=m.exec(i);return a&&a[1]?new v(t,o,r,a[1]):new p(t,o,r)}class S{constructor(){this.url=void 0,this.container=void 0,this.enableMouseMove=!0,this.defaultAsset=new A({spatial:"lookingglass",quiltType:"FourKSquare",size:new T({width:4320}),contentType:"image/png"}),this.defaultMobileAsset=new A({spatial:"2d",size:new T({width:1080}),contentType:"video/mp4"}),this.spatialProps={spatialType:t.LOOKING_GLASS,stereoMode:s.OFF,quilt:null}}}class M{constructor(i){this.name=void 0,this.hash=void 0,this.assets=void 0,Object.assign(this,i)}}class A{constructor(i){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0,Object.assign(this,i)}}class P{constructor(i){this.columns=void 0,this.rows=void 0,Object.assign(this,i)}}class T{constructor(i){this.width=void 0,this.height=void 0,Object.assign(this,i)}}class _{constructor(i){var e=this;this._props=new S,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.gawd=void 0,this.video=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.EasingFunctions={linear:function(i){return i},easeInQuad:function(i){return i*i},easeOutQuad:function(i){return i*(2-i)},easeInOutQuad:function(i){return i<.5?2*i*i:(4-2*i)*i-1},easeInCubic:function(i){return i*i*i},easeOutCubic:function(i){return--i*i*i+1},easeInOutCubic:function(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1},easeInQuart:function(i){return i*i*i*i},easeOutQuart:function(i){return 1- --i*i*i*i},easeInOutQuart:function(i){return i<.5?8*i*i*i*i:1-8*--i*i*i*i},easeInQuint:function(i){return i*i*i*i*i},easeOutQuint:function(i){return 1+--i*i*i*i*i},easeInOutQuint:function(i){return i<.5?16*i*i*i*i*i:1+16*--i*i*i*i*i}},this.setProps(this._props,i),this.clock=new n,this._props.container?this._props.url&&this.loadGawdConfig(this._props.url).then((function(i){e.initGawd(i)})):console.warn("No container was set")}setProps(i,e){if(e)for(var t in e)t in i?i[t]=e[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var i=this;this.scene||(this.scene=new o,this.renderer=new r({antialias:!0}),this.renderer.xr.enabled=!1,this._props.container.appendChild(this.renderer.domElement),this.camera=new a(90,this.aspectRatio,.01,1e3),this.camera.position.z=10,this.scene.add(this.camera),this.resize(),this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",this.resize.bind(this)))}resize(){this.camera.aspect=this.aspectRatio,this.camera.updateProjectionMatrix(),this.renderer.setSize(this._props.container.clientWidth,this._props.container.clientHeight)}initGawd(i){var e=this;this.gawd=i;var t=null;b().os.match(/iOS|android/i)&&(t=i.assets.filter((function(i){return i.spatial==e._props.defaultMobileAsset.spatial&&i.size.width==e._props.defaultMobileAsset.size.width&&(i.quiltType==e._props.defaultMobileAsset.quiltType||!e._props.defaultMobileAsset.quiltType)&&i.contentType==e._props.defaultMobileAsset.contentType}))[0])||(t=i.assets.filter((function(i){return i.spatial==e._props.defaultAsset.spatial&&i.size.width==e._props.defaultAsset.size.width&&(i.quiltType==e._props.defaultAsset.quiltType||!e._props.defaultAsset.quiltType)&&i.contentType==e._props.defaultAsset.contentType}))[0]),this.initMedia(t)}initMedia(i){if(i){if("image/png"==i.contentType)(new h).load(i.url,function(e){this.loadSpatialPlayer(e,i)}.bind(this));else if("video/mp4"==i.contentType){var e="gawd-video-"+this.gawd.hash;this.video=document.getElementById(e),this.video||(this.video=document.createElement("video"),this.video.id=e,this.video.src=i.url,this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.preload="auto",this.video.autoplay=!0,this.video.loop=!0,this.video.playsInline=!0,this.video.style.width="100%",this.video.style.height="100%",this.video.style.display="none",this.props.container.appendChild(this.video),this.video.play());var t=new l(this.video);this.loadSpatialPlayer(t,i)}}else console.warn("No GawdAsset found!")}loadSpatialPlayer(t,s){var n=new i;if(s.quilt){this.initThree(),n.columns=s.quilt.columns>0?s.quilt.columns:8,n.rows=s.quilt.rows>0?s.quilt.rows:6,n.width=s.viewSize.width>0?s.viewSize.width:480,n.height=s.viewSize.height>0?s.viewSize.height:640,this._props.spatialProps.quilt=n,this.spatialPlayer=new e(t,null,this._props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.scene.add(this.spatialPlayer);var o=this.camera.position.z-this.spatialPlayer.position.z,r=this.aspectRatio;this.camera.fov=Math.atan(r/o)*(180/Math.PI),this.camera.updateProjectionMatrix(),this._props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}else this.video.style.display="",this._props.enableMouseMove=!1}loadGawdConfig(i){return(e=function*(){var e=yield fetch(i);return yield e.json()},function(){var i=this,t=arguments;return new Promise((function(s,n){var o=e.apply(i,t);function r(i){d(o,s,n,r,a,"next",i)}function a(i){d(o,s,n,r,a,"throw",i)}r(void 0)}))})();var e}onMouseMove(i){this.spatialPlayer&&(this.targetAngle=(1-i.clientX/window.innerWidth)*(this.totalAngles-1),this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){this._props.enableMouseMove&&(this.aniCurTime+=this.clock.getDelta(),this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration))))),this.renderer.render(this.scene,this.camera)}lerp(i,e,t){return i+(e-i)*(t=(t=t<0?0:t)>1?1:t)}dispose(){this.scene.remove(this.spatialPlayer),this.spatialPlayer.dispose(),window.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("resize",this.resize.bind(this))}get aspectRatio(){return this._props.container.clientWidth/this._props.container.clientHeight}get props(){return this._props}}export{M as Gawd,A as GawdAsset,P as GawdQuilt,_ as Player,S as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
