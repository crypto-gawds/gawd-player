import{SpatialType as i,StereoMode as e,QuiltConfig as t,Player as n,Props as o}from"three-spatial-viewer";import{Scene as r,WebGLRenderer as s,PerspectiveCamera as a,TextureLoader as d,VideoTexture as l}from"three";function h(i,e,t,n,o,r,s){try{var a=i[r](s),d=a.value}catch(i){return void t(i)}a.done?e(d):Promise.resolve(d).then(n,o)}var p=function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;var n=Array(i),o=0;for(e=0;e<t;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},c=function(i,e,t){this.name=i,this.version=e,this.os=t,this.type="browser"},u=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},w=function(i,e,t,n){this.name=i,this.version=e,this.os=t,this.bot=n,this.type="bot-device"},v=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},m=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},f=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,g=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],y=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function S(i){return i?b(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new m:"undefined"!=typeof navigator?b(navigator.userAgent):"undefined"!=typeof process&&process.version?new u(process.version.slice(1)):null}function b(i){var e=function(i){return""!==i&&g.reduce((function(e,t){var n=t[0],o=t[1];if(e)return e;var r=o.exec(i);return!!r&&[n,r]}),!1)}(i);if(!e)return null;var t=e[0],n=e[1];if("searchbot"===t)return new v;var o=n[1]&&n[1].split(/[._]/).slice(0,3);o?o.length<3&&(o=p(o,function(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}(3-o.length))):o=[];var r=o.join("."),s=function(i){for(var e=0,t=y.length;e<t;e++){var n=y[e],o=n[0];if(n[1].exec(i))return o}return null}(i),a=f.exec(i);return a&&a[1]?new w(t,r,s,a[1]):new c(t,r,s)}class P{constructor(){this.url=void 0,this.container=void 0,this.spatialProps=new o}}class W{constructor(t){var n=this;this.props=new P,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.props.spatialProps.spatialType=i.LOOKING_GLASS,this.props.spatialProps.stereoMode=e.COLOR,this.setProps(this.props,t),this.props.container?(this.initThree(),this.props.url&&this.loadGawdConfig(this.props.url).then((function(i){n.initGawd(i)}))):console.warn("No container was set")}initThree(){var i=this;this.scene=new r,this.renderer=new s({antialias:!0}),this.renderer.setSize(this.props.container.clientWidth,this.props.container.clientHeight),this.renderer.xr.enabled=!1,this.props.container.appendChild(this.renderer.domElement),this.camera=new a(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",(function(e){i.camera.aspect=i.aspectRatio,i.camera.updateProjectionMatrix(),i.renderer.setSize(i.props.container.clientWidth,i.props.container.clientHeight)})),window.addEventListener("mousemove",this.onMouseMove.bind(this))}render(){this.renderer.render(this.scene,this.camera)}onMouseMove(i){if(this.spatialPlayer){var e=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,t=i.clientX/window.innerWidth;this.spatialPlayer.quiltAngle=Math.round(-t*e)}}initGawd(i){var e=S(),t=null;t="firefox"==e.name&&e.os.match(/windows/i)||e.os.match(/iOS|android/i)?i.assets.filter((function(i){return"lookingglass"==i.spatial&&"FourKSquare"==i.quiltType&&"image/png"==i.contentType}))[0]:i.assets.filter((function(i){return"lookingglass"==i.spatial&&"FourKSquare"==i.quiltType&&"video/mp4"==i.contentType}))[0],this.initMedia(t)}initMedia(i){if("image/png"==i.contentType)(new d).load(i.url,function(e){this.loadSpatialPlayer(e,i)}.bind(this));else if("video/mp4"==i.contentType){var e=document.createElement("video");e.src=i.url,e.crossOrigin="anonymous",e.muted=!0,e.autoplay=!0,e.loop=!0,e.playsInline=!0,document.body.appendChild(e),e.play();var t=new l(e);this.loadSpatialPlayer(t,i)}}loadSpatialPlayer(i,e){var o=new t;o.columns=e.quilt.columns>0?e.quilt.columns:8,o.rows=e.quilt.rows>0?e.quilt.rows:6,o.width=e.viewSize.width>0?e.viewSize.width:480,o.height=e.viewSize.height>0?e.viewSize.height:640,this.props.spatialProps.quilt=o,this.spatialPlayer=new n(i,null,this.props.spatialProps),this.scene.add(this.spatialPlayer);var r=this.camera.position.z-this.spatialPlayer.position.z,s=this.aspectRatio;this.camera.fov=Math.atan(s/r)*(180/Math.PI),this.camera.updateProjectionMatrix()}loadGawdConfig(i){return(e=function*(){var e=yield fetch(i);return yield e.json()},function(){var i=this,t=arguments;return new Promise((function(n,o){var r=e.apply(i,t);function s(i){h(r,n,o,s,a,"next",i)}function a(i){h(r,n,o,s,a,"throw",i)}s(void 0)}))})();var e}setProps(i,e){if(e)for(var t in e)t in i?i[t]=e[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}get aspectRatio(){return this.props.container.clientWidth/this.props.container.clientHeight}}export{W as Player,P as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
