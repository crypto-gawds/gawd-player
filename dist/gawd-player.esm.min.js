import{SpatialType as i,StereoMode as e,QuiltConfig as t,Player as o,Props as n}from"three-spatial-viewer";export{QuiltConfig,Props as SpatialProps,SpatialType,StereoMode}from"three-spatial-viewer";import{Scene as s,WebGLRenderer as r,PerspectiveCamera as a,TextureLoader as d,VideoTexture as l}from"three";function h(i,e,t,o,n,s,r){try{var a=i[s](r),d=a.value}catch(i){return void t(i)}a.done?e(d):Promise.resolve(d).then(o,n)}var p=function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;var o=Array(i),n=0;for(e=0;e<t;e++)for(var s=arguments[e],r=0,a=s.length;r<a;r++,n++)o[n]=s[r];return o},c=function(i,e,t){this.name=i,this.version=e,this.os=t,this.type="browser"},u=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},w=function(i,e,t,o){this.name=i,this.version=e,this.os=t,this.bot=o,this.type="bot-device"},v=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},m=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},f=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,g=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],y=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function S(i){return i?P(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new m:"undefined"!=typeof navigator?P(navigator.userAgent):"undefined"!=typeof process&&process.version?new u(process.version.slice(1)):null}function P(i){var e=function(i){return""!==i&&g.reduce((function(e,t){var o=t[0],n=t[1];if(e)return e;var s=n.exec(i);return!!s&&[o,s]}),!1)}(i);if(!e)return null;var t=e[0],o=e[1];if("searchbot"===t)return new v;var n=o[1]&&o[1].split(/[._]/).slice(0,3);n?n.length<3&&(n=p(n,function(i){for(var e=[],t=0;t<i;t++)e.push("0");return e}(3-n.length))):n=[];var s=n.join("."),r=function(i){for(var e=0,t=y.length;e<t;e++){var o=y[e],n=o[0];if(o[1].exec(i))return n}return null}(i),a=f.exec(i);return a&&a[1]?new w(t,s,r,a[1]):new c(t,s,r)}class b{constructor(){this.url=void 0,this.container=void 0,this.spatialProps=new n}}class W{constructor(){this.name=void 0,this.assets=void 0}}class O{constructor(){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0}}class M{constructor(){this.columns=void 0,this.rows=void 0}}class T{constructor(t){var o=this;this.props=new b,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.props.spatialProps.spatialType=i.LOOKING_GLASS,this.props.spatialProps.stereoMode=e.COLOR,this.setProps(this.props,t),this.props.container?(this.initThree(),this.props.url&&this.loadGawdConfig(this.props.url).then((function(i){o.initGawd(i)}))):console.warn("No container was set")}initThree(){var i=this;this.scene=new s,this.renderer=new r({antialias:!0}),this.renderer.setSize(this.props.container.clientWidth,this.props.container.clientHeight),this.renderer.xr.enabled=!1,this.props.container.appendChild(this.renderer.domElement),this.camera=new a(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",(function(e){i.camera.aspect=i.aspectRatio,i.camera.updateProjectionMatrix(),i.renderer.setSize(i.props.container.clientWidth,i.props.container.clientHeight)})),window.addEventListener("mousemove",this.onMouseMove.bind(this))}render(){this.renderer.render(this.scene,this.camera)}onMouseMove(i){if(this.spatialPlayer){var e=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,t=i.clientX/window.innerWidth;this.spatialPlayer.quiltAngle=Math.round(-t*e)}}initGawd(i){var e=S(),t=null;t="firefox"==e.name&&e.os.match(/windows/i)||e.os.match(/iOS|android/i)?i.assets.filter((function(i){return"lookingglass"==i.spatial&&"FourKSquare"==i.quiltType&&"image/png"==i.contentType}))[0]:i.assets.filter((function(i){return"lookingglass"==i.spatial&&"FourKSquare"==i.quiltType&&"video/mp4"==i.contentType}))[0],this.initMedia(t)}initMedia(i){if("image/png"==i.contentType)(new d).load(i.url,function(e){this.loadSpatialPlayer(e,i)}.bind(this));else if("video/mp4"==i.contentType){var e=document.createElement("video");e.src=i.url,e.crossOrigin="anonymous",e.muted=!0,e.autoplay=!0,e.loop=!0,e.playsInline=!0,document.body.appendChild(e),e.play();var t=new l(e);this.loadSpatialPlayer(t,i)}}loadSpatialPlayer(i,e){var n=new t;n.columns=e.quilt.columns>0?e.quilt.columns:8,n.rows=e.quilt.rows>0?e.quilt.rows:6,n.width=e.viewSize.width>0?e.viewSize.width:480,n.height=e.viewSize.height>0?e.viewSize.height:640,this.props.spatialProps.quilt=n,this.spatialPlayer=new o(i,null,this.props.spatialProps),this.scene.add(this.spatialPlayer);var s=this.camera.position.z-this.spatialPlayer.position.z,r=this.aspectRatio;this.camera.fov=Math.atan(r/s)*(180/Math.PI),this.camera.updateProjectionMatrix()}loadGawdConfig(i){return(e=function*(){var e=yield fetch(i);return yield e.json()},function(){var i=this,t=arguments;return new Promise((function(o,n){var s=e.apply(i,t);function r(i){h(s,o,n,r,a,"next",i)}function a(i){h(s,o,n,r,a,"throw",i)}r(void 0)}))})();var e}setProps(i,e){if(e)for(var t in e)t in i?i[t]=e[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}get aspectRatio(){return this.props.container.clientWidth/this.props.container.clientHeight}}export{W as Gawd,O as GawdAsset,M as GawdQuilt,T as Player,b as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
