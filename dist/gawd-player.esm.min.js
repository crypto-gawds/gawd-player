import{QuiltConfig as e,Player as i,SpatialType as t,StereoMode as s}from"three-spatial-viewer";import{Clock as n,Scene as o,WebGLRenderer as r,PerspectiveCamera as a,TextureLoader as l,VideoTexture as h,LinearMipmapLinearFilter as u}from"three";function d(e,i,t,s,n,o,r){try{var a=e[o](r),l=a.value}catch(e){return void t(e)}a.done?i(l):Promise.resolve(l).then(s,n)}var p=function(){for(var e=0,i=0,t=arguments.length;i<t;i++)e+=arguments[i].length;var s=Array(e),n=0;for(i=0;i<t;i++)for(var o=arguments[i],r=0,a=o.length;r<a;r++,n++)s[n]=o[r];return s},c=function(e,i,t){this.name=e,this.version=i,this.os=t,this.type="browser"},w=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},v=function(e,i,t,s){this.name=e,this.version=i,this.os=t,this.bot=s,this.type="bot-device"},f=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},m=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},g=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,y=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],b=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function S(e){return e?O(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new m:"undefined"!=typeof navigator?O(navigator.userAgent):"undefined"!=typeof process&&process.version?new w(process.version.slice(1)):null}function O(e){var i=function(e){return""!==e&&y.reduce((function(i,t){var s=t[0],n=t[1];if(i)return i;var o=n.exec(e);return!!o&&[s,o]}),!1)}(e);if(!i)return null;var t=i[0],s=i[1];if("searchbot"===t)return new f;var n=s[1]&&s[1].split(/[._]/).slice(0,3);n?n.length<3&&(n=p(n,function(e){for(var i=[],t=0;t<e;t++)i.push("0");return i}(3-n.length))):n=[];var o=n.join("."),r=function(e){for(var i=0,t=b.length;i<t;i++){var s=b[i],n=s[0];if(s[1].exec(e))return n}return null}(e),a=g.exec(e);return a&&a[1]?new v(t,o,r,a[1]):new c(t,o,r)}class A{constructor(){this.url=void 0,this.container=void 0,this.enableMouseMove=!0,this.defaultAsset=new _({spatial:"lookingglass",quiltType:"FourKSquare",size:new T({width:4320}),contentType:"image/png"}),this.defaultMobileAsset=new _({spatial:"2d",size:new T({width:1080}),contentType:"video/mp4"}),this.spatialProps={spatialType:t.LOOKING_GLASS,stereoMode:s.OFF,quilt:null}}}class M{constructor(e){this.name=void 0,this.hash=void 0,this.assets=void 0,Object.assign(this,e)}}class _{constructor(e){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0,Object.assign(this,e)}}class P{constructor(e){this.columns=void 0,this.rows=void 0,Object.assign(this,e)}}class T{constructor(e){this.width=void 0,this.height=void 0,Object.assign(this,e)}}class W{constructor(e){var i=this;this._props=new A,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.gawd=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.EasingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},this.setProps(this._props,e),this.clock=new n,this._props.container?(this.initThree(),this._props.url&&this.loadGawdConfig(this._props.url).then((function(e){i.initGawd(e)}))):console.warn("No container was set")}setProps(e,i){if(i)for(var t in i)t in e?e[t]=i[t]:console.warn("GawdViewer: Provided ".concat(t," in config but it is not a valid property and will be ignored"))}initThree(){var e=this;this.scene=new o,this.renderer=new r({antialias:!0}),this.renderer.setSize(this._props.container.clientWidth,this._props.container.clientHeight),this.renderer.xr.enabled=!1,this._props.container.appendChild(this.renderer.domElement),this.camera=new a(90,this.aspectRatio,.01,1e3),this.camera.position,this.scene.add(this.camera),this.camera.position.z=10,this.renderer.setAnimationLoop((function(){e.render()})),window.addEventListener("resize",(function(i){e.camera.aspect=e.aspectRatio,e.camera.updateProjectionMatrix(),e.renderer.setSize(e._props.container.clientWidth,e._props.container.clientHeight)}))}initGawd(e){var i=this;this.gawd=e;var t=null;S().os.match(/iOS|android/i)&&(t=e.assets.filter((function(e){return e.spatial==i._props.defaultMobileAsset.spatial&&e.size.width==i._props.defaultMobileAsset.size.width&&(e.quiltType==i._props.defaultMobileAsset.quiltType||!i._props.defaultMobileAsset.quiltType)&&e.contentType==i._props.defaultMobileAsset.contentType}))[0])||(t=e.assets.filter((function(e){return e.spatial==i._props.defaultAsset.spatial&&e.size.width==i._props.defaultAsset.size.width&&(e.quiltType==i._props.defaultAsset.quiltType||!i._props.defaultAsset.quiltType)&&e.contentType==i._props.defaultAsset.contentType}))[0]),this.initMedia(t)}initMedia(e){if(e){if("image/png"==e.contentType)(new l).load(e.url,function(i){this.loadSpatialPlayer(i,e)}.bind(this));else if("video/mp4"==e.contentType){var i="gawd-video-"+this.gawd.hash,t=document.getElementById(i);t||((t=document.createElement("video")).id=i,t.src=e.url,t.crossOrigin="anonymous",t.muted=!0,t.autoplay=!0,t.loop=!0,t.playsInline=!0,t.style.display="none",document.body.appendChild(t),t.play());var s=new h(t);this.loadSpatialPlayer(s,e)}}else console.warn("No GawdAsset found!")}loadSpatialPlayer(t,s){var n=new e;s.quilt?(n.columns=s.quilt.columns>0?s.quilt.columns:8,n.rows=s.quilt.rows>0?s.quilt.rows:6,n.width=s.viewSize.width>0?s.viewSize.width:480,n.height=s.viewSize.height>0?s.viewSize.height:640):(n.columns=1,n.rows=1,n.width=s.size.width,n.height=s.size.height,this._props.enableMouseMove=!1),this._props.spatialProps.quilt=n,this.spatialPlayer=new i(t,null,this._props.spatialProps);var o=this.spatialPlayer.texture;o.minFilter=u,this.spatialPlayer.texture=o,this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.scene.add(this.spatialPlayer);var r=this.camera.position.z-this.spatialPlayer.position.z,a=this.aspectRatio;this.camera.fov=Math.atan(a/r)*(180/Math.PI),this.camera.updateProjectionMatrix(),this._props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}loadGawdConfig(e){return(i=function*(){var i=yield fetch(e);return yield i.json()},function(){var e=this,t=arguments;return new Promise((function(s,n){var o=i.apply(e,t);function r(e){d(o,s,n,r,a,"next",e)}function a(e){d(o,s,n,r,a,"throw",e)}r(void 0)}))})();var i}onMouseMove(e){this.spatialPlayer&&(this.targetAngle=(1-e.clientX/window.innerWidth)*(this.totalAngles-1),this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){this._props.enableMouseMove&&(this.aniCurTime+=this.clock.getDelta(),this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration))))),this.renderer.render(this.scene,this.camera)}lerp(e,i,t){return e+(i-e)*(t=(t=t<0?0:t)>1?1:t)}get aspectRatio(){return this._props.container.clientWidth/this._props.container.clientHeight}get props(){return this._props}}export{M as Gawd,_ as GawdAsset,P as GawdQuilt,W as Player,A as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
