import{QuiltConfig as i,Player as t,StereoMode as e,SpatialType as s}from"three-spatial-viewer";import{Clock as n,Scene as o,WebGLRenderer as r,PerspectiveCamera as a,TextureLoader as h,VideoTexture as l}from"three";function d(i,t,e,s,n,o,r){try{var a=i[o](r),h=a.value}catch(i){return void e(i)}a.done?t(h):Promise.resolve(h).then(s,n)}var u=function(i,t,e){if(e||2===arguments.length)for(var s,n=0,o=t.length;n<o;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return i.concat(s||Array.prototype.slice.call(t))},p=function(i,t,e){this.name=i,this.version=t,this.os=e,this.type="browser"},c=function(i){this.version=i,this.type="node",this.name="node",this.os=process.platform},v=function(i,t,e,s){this.name=i,this.version=t,this.os=e,this.bot=s,this.type="bot-device"},m=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},w=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},y=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,g=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],f=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function b(i){return i?M(i):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new w:"undefined"!=typeof navigator?M(navigator.userAgent):"undefined"!=typeof process&&process.version?new c(process.version.slice(1)):null}function M(i){var t=function(i){return""!==i&&g.reduce((function(t,e){var s=e[0],n=e[1];if(t)return t;var o=n.exec(i);return!!o&&[s,o]}),!1)}(i);if(!t)return null;var e=t[0],s=t[1];if("searchbot"===e)return new m;var n=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);n?n.length<3&&(n=u(u([],n,!0),function(i){for(var t=[],e=0;e<i;e++)t.push("0");return t}(3-n.length),!0)):n=[];var o=n.join("."),r=function(i){for(var t=0,e=f.length;t<e;t++){var s=f[t],n=s[0];if(s[1].exec(i))return n}return null}(i),a=y.exec(i);return a&&a[1]?new v(e,o,r,a[1]):new p(e,o,r)}class T{constructor(){this.url=void 0,this.container=void 0,this.enableMouseMove=!0,this.toggleModes=!1,this.defaultThumbnailSize=640,this.defaultAsset=new O({spatial:"lookingglass",quiltType:"FourKSquare",size:new S({width:4320}),contentType:"image/png"}),this.defaultMobileAsset=new O({spatial:"2d",size:new S({width:1080}),contentType:"video/mp4"}),this.animationAsset=new O({spatial:"2d",size:new S({width:1080}),contentType:"video/mp4"}),this.spatialProps={spatialType:s.LOOKING_GLASS,stereoMode:e.OFF,quilt:null},this.gawdData=void 0}}class A{constructor(i){this.name=void 0,this.hash=void 0,this.assets=void 0,Object.assign(this,i)}}class O{constructor(i){this.url=void 0,this.spatial=void 0,this.quilt=void 0,this.quiltType=void 0,this.size=void 0,this.viewSize=void 0,this.contentType=void 0,Object.assign(this,i)}}class P{constructor(i){this.columns=void 0,this.rows=void 0,Object.assign(this,i)}}class S{constructor(i){this.width=void 0,this.height=void 0,Object.assign(this,i)}}class _{constructor(i){var t=this;this._props=new T,this.scene=void 0,this.renderer=void 0,this.spatialPlayer=void 0,this.camera=void 0,this.clock=void 0,this.gawd=void 0,this.video=void 0,this.thumbnail=void 0,this.startAngle=0,this.targetAngle=0,this.totalAngles=0,this.aniCurTime=0,this.aniDuration=.5,this.hideThumbnail=!1,this.thumbCurTime=0,this.EasingFunctions={linear:function(i){return i},easeInQuad:function(i){return i*i},easeOutQuad:function(i){return i*(2-i)},easeInOutQuad:function(i){return i<.5?2*i*i:(4-2*i)*i-1},easeInCubic:function(i){return i*i*i},easeOutCubic:function(i){return--i*i*i+1},easeInOutCubic:function(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1},easeInQuart:function(i){return i*i*i*i},easeOutQuart:function(i){return 1- --i*i*i*i},easeInOutQuart:function(i){return i<.5?8*i*i*i*i:1-8*--i*i*i*i},easeInQuint:function(i){return i*i*i*i*i},easeOutQuint:function(i){return 1+--i*i*i*i*i},easeInOutQuint:function(i){return i<.5?16*i*i*i*i*i:1+16*--i*i*i*i*i}},this.setProps(this._props,i),this.clock=new n,this._props.container?this._props.gawdData&&this._props.gawdData.assets&&this._props.gawdData.assets.length>0?this.initGawd(this._props.gawdData):this._props.url&&this.loadGawdConfig(this._props.url).then((function(i){t.initGawd(i)})):console.warn("No container was set")}setProps(i,t){if(t)for(var e in t)e in i?i[e]=t[e]:console.warn("GawdViewer: Provided ".concat(e," in config but it is not a valid property and will be ignored"))}initThree(){var i=this;this.scene||(this.scene=new o,this.renderer=new r({antialias:!0}),this.renderer.xr.enabled=!1,this._props.container.appendChild(this.renderer.domElement),this.camera=new a(90,this.aspectRatio,.01,1e3),this.camera.position.z=10,this.scene.add(this.camera),this.resize(),this.renderer.setAnimationLoop((function(){i.render()})),window.addEventListener("resize",this.resize.bind(this)),this._props.toggleModes&&this._props.container.addEventListener("click",this.toggleDisplayMode.bind(this)))}resize(){this.camera.aspect=this.aspectRatio,this.camera.updateProjectionMatrix(),this.renderer.setSize(this._props.container.clientWidth,this._props.container.clientHeight)}isMobile(){return null!=b().os.match(/iOS|android/i)}initGawd(i){var t=this;this.gawd=i;var e=null;this.isMobile()&&(e=i.assets.filter((function(i){return i.spatial==t._props.defaultMobileAsset.spatial&&i.size.width==t._props.defaultMobileAsset.size.width&&(i.quiltType==t._props.defaultMobileAsset.quiltType||!t._props.defaultMobileAsset.quiltType)&&i.contentType==t._props.defaultMobileAsset.contentType}))[0]),e||(e=i.assets.filter((function(i){return i.spatial==t._props.defaultAsset.spatial&&i.size.width==t._props.defaultAsset.size.width&&(i.quiltType==t._props.defaultAsset.quiltType||!t._props.defaultAsset.quiltType)&&i.contentType==t._props.defaultAsset.contentType}))[0]),this.initThumbnail(),this.initMedia(e)}initThumbnail(){var i=this,t=this.gawd.assets.sort((function(i,t){return i.size.width-t.size.width})).find((function(t){return"image/png"==t.contentType&&t.size.width>=i._props.defaultThumbnailSize})).url;this.thumbnail=document.createElement("img"),this.thumbnail.src=t,this.thumbnail.crossOrigin="anonymous",this.thumbnail.style.width="100%",this.thumbnail.style.height="100%",this.thumbnail.style.position="absolute",this.thumbnail.style.left="0",this._props.container.appendChild(this.thumbnail)}hideThumb(){this.hideThumbnail=!0,this.thumbCurTime=0}initMedia(i,t){var e=this;i?"image/png"==i.contentType?(new h).load(i.url,function(e){this.loadSpatialPlayer(e,i),this.hideThumb(),t&&t()}.bind(this)):"video/mp4"==i.contentType&&this.initVideo(i,(function(){var s=new l(e.video);e.loadSpatialPlayer(s,i),e.hideThumb(),t&&t()})):console.warn("No GawdAsset found!")}initVideo(i,t){var e="gawd-video-"+this.gawd.hash;this.video=document.getElementById(e),this.video||(this.video=document.createElement("video"),this.video.id=e,this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.preload="auto",this.video.autoplay=!0,this.video.loop=!0,this.video.playsInline=!0,this.video.style.width="100%",this.video.style.height="100%",this.video.style.display="none",this.props.container.appendChild(this.video)),t&&(this.video.ontimeupdate=function(){this.video.currentTime>0&&(t(),this.video.ontimeupdate=null,t=null)}.bind(this),this.video.src=i.url,this.video.play())}loadSpatialPlayer(e,s){var n=new i;if(this.initThree(),s.quilt){n.columns=s.quilt.columns>0?s.quilt.columns:8,n.rows=s.quilt.rows>0?s.quilt.rows:6,n.width=s.viewSize.width>0?s.viewSize.width:480,n.height=s.viewSize.height>0?s.viewSize.height:640,this._props.spatialProps.quilt=n,this.spatialPlayer=new t(e,null,this._props.spatialProps),this.totalAngles=this.spatialPlayer.quiltColumns*this.spatialPlayer.quiltRows,this.spatialPlayer.quiltAngle=this.targetAngle=this.totalAngles/2,this.scene.add(this.spatialPlayer);var o=this.camera.position.z-this.spatialPlayer.position.z,r=this.aspectRatio;this.camera.fov=Math.atan(r/o)*(180/Math.PI),this.camera.updateProjectionMatrix(),this._props.enableMouseMove&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}else this.video.style.display="",this._props.enableMouseMove=!1}toggleDisplayMode(){this.spatialPlayer?(this.spatialPlayer.quiltStereoEyeDistance=8,this.video&&""==this.video.style.display?(this.video.style.display="none",this.video.pause(),this.renderer.domElement.style.display="",this.spatialPlayer.stereoMode=e.OFF):this.spatialPlayer.stereoMode==e.OFF?this.spatialPlayer.stereoMode=e.COLOR:this.spatialPlayer.stereoMode==e.COLOR&&(this.initVideo(this.getAnimationAsset()),this.renderer.domElement.style.display="none",this.video.style.display="",this.video.play())):(this._props.enableMouseMove=!0,this.initMedia(this.getQuiltPNGAsset(),function(){this.video.style.display="none",this.renderer.domElement.style.display="",this.spatialPlayer.stereoMode=e.OFF}.bind(this)))}getQuiltPNGAsset(){return this.gawd.assets.find((function(i){return"image/png"==i.contentType&&"FourKSquare"==i.quiltType}))}getAnimationAsset(){var i=this;return this.gawd.assets.sort((function(i,t){return t.size.width-i.size.width})).find((function(t){return t.contentType==i._props.animationAsset.contentType&&t.size.width<=i._props.animationAsset.size.width&&t.spatial==i._props.animationAsset.spatial}))}loadGawdConfig(i){return(t=function*(){var t=yield fetch(i);return yield t.json()},function(){var i=this,e=arguments;return new Promise((function(s,n){var o=t.apply(i,e);function r(i){d(o,s,n,r,a,"next",i)}function a(i){d(o,s,n,r,a,"throw",i)}r(void 0)}))})();var t}onMouseMove(i){this.spatialPlayer&&(this.targetAngle=(1-i.clientX/window.innerWidth)*(this.totalAngles-1),this.startAngle=this.spatialPlayer.quiltAngle,this.aniCurTime=0)}render(){var i=this.clock.getDelta();this._props.enableMouseMove&&(this.aniCurTime+=i,this.spatialPlayer&&this.aniCurTime/this.aniDuration<=1&&"0"==this.thumbnail.style.opacity&&(this.spatialPlayer.quiltAngle=Math.round(this.lerp(this.startAngle,this.targetAngle,this.EasingFunctions.easeOutCubic(this.aniCurTime/this.aniDuration))))),this.hideThumbnail&&(this.thumbCurTime+=i,this.thumbnail&&"0"!=this.thumbnail.style.opacity&&(this.thumbnail.style.opacity=this.lerp(1,0,this.EasingFunctions.linear(this.thumbCurTime/.25)).toString())),this.scene&&this.renderer.render(this.scene,this.camera)}lerp(i,t,e){return i+(t-i)*(e=(e=e<0?0:e)>1?1:e)}dispose(){this.scene&&this.scene.remove(this.spatialPlayer),this.spatialPlayer&&this.spatialPlayer.dispose(),this.thumbnail&&this.thumbnail.remove(),this.video&&this.video.remove(),this.renderer?.domElement&&this.renderer.domElement.remove(),window.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("resize",this.resize.bind(this))}get aspectRatio(){return this._props.container.clientWidth/this._props.container.clientHeight}get props(){return this._props}}export{A as Gawd,O as GawdAsset,P as GawdQuilt,_ as Player,T as PlayerProps};
//# sourceMappingURL=gawd-player.esm.min.js.map
