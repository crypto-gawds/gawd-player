{"version":3,"file":"gawd-player.amd.js","sources":["../src/components/player.ts"],"sourcesContent":["import * as http from 'http';\nimport { SpatialType, StereoMode } from 'three-spatial-viewer';\nimport { SpatialPlayer, QuiltConfig } from './spatial-viewer'\nimport { WebGLRenderer, PerspectiveCamera, Scene, ImageLoader, TextureLoader, Texture } from './three'\n\nclass Props {\n  public url: string\n  public container: HTMLElement\n}\n\nclass Gawd {\n  public name: string\n  public assets: Array<GawdAsset>\n}\n\nclass GawdAsset {\n  public url: string\n  public spatial: string\n  public quilt: GawdQuilt\n  public size: Resolution\n  public viewSize: Resolution\n  public contentType: string\n}\n\nclass GawdQuilt {\n  public columns: number\n  public rows: number\n}\n\nclass Resolution {\n  public width: number\n  public height: number\n}\n\nexport { Props as PlayerProps, Gawd, GawdAsset }\n\nexport default class Player {\n\n  private props: Props = new Props()\n  private scene: Scene\n  private renderer: WebGLRenderer\n  private spatialPlayer: SpatialPlayer\n  private camera: PerspectiveCamera\n\n  constructor(props?: object) {\n    this.setProps(this.props, props)\n\n    if (this.props.container) {\n      this.initThree()\n    }\n    else {\n      console.warn(`No container was set`)\n      return;\n    }\n\n    if (this.props.url) {\n      this.loadGawdConfig(this.props.url).then(data => {\n        this.initGawd(data)\n      });\n    }\n  }\n\n  private initThree(): void {\n    this.scene = new Scene();\n\n    this.renderer = new WebGLRenderer({ antialias: true });\n    this.renderer.setSize(this.props.container.clientWidth, this.props.container.clientHeight);\n    this.renderer.xr.enabled = false;\n    this.props.container.appendChild(this.renderer.domElement);\n\n    this.camera = new PerspectiveCamera(90, this.aspectRatio, 0.01, 1000);\n    this.camera.position\n\n    this.scene.add(this.camera);\n\n    this.camera.position.z = 10;\n\n    this.renderer.setAnimationLoop(() => {\n      this.render()\n    });\n\n    window.addEventListener('resize', ev => {\n      this.camera.aspect = this.aspectRatio\n      this.camera.updateProjectionMatrix()\n      this.renderer.setSize(this.props.container.clientWidth, this.props.container.clientHeight)\n    })\n\n    window.addEventListener('mousemove', this.onMouseMove.bind(this))\n  }\n\n  private render(): void {\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  private onMouseMove(e: MouseEvent): void {\n    if (this.spatialPlayer) {\n      let totalAngles = this.spatialPlayer.quiltColumns * this.spatialPlayer.quiltRows\n      let xpos = e.clientX / window.innerWidth\n      // console.log(e.clientX, window.innerWidth, xpos, totalAngles)\n      this.spatialPlayer.quiltAngle = Math.round(xpos * totalAngles)\n    }\n  }\n\n  private initGawd(gawd: Gawd): void {\n    console.log(`Loading ${gawd.name}...`)\n    let lkgAssets: GawdAsset[] = gawd.assets.filter(a => a.spatial == 'lookingglass')\n    this.initMedia(lkgAssets[0])\n  }\n\n  private initMedia(asset: GawdAsset): void {\n    if (asset.contentType == \"image/png\") {\n      console.log(`Loading image: ${asset.url}`)\n      const loader = new TextureLoader()\n      loader.load(asset.url, function (tex) {\n        this.loadSpatialPlayer(tex, asset)\n      }.bind(this))\n    }\n    else if (asset.contentType == 'video/mp4') {\n    }\n  }\n\n  private loadSpatialPlayer(texture: Texture, asset: GawdAsset): void {\n    let config = new QuiltConfig();\n    config.columns = asset.quilt.columns > 0 ? asset.quilt.columns : 8\n    config.rows = asset.quilt.rows > 0 ? asset.quilt.rows : 6\n    config.width = asset.viewSize.width > 0 ? asset.viewSize.width : 480\n    config.height = asset.viewSize.height > 0 ? asset.viewSize.height : 640\n\n    this.spatialPlayer = new SpatialPlayer(texture, null, {\n      spatialType: SpatialType.LOOKING_GLASS,\n      stereoMode: StereoMode.COLOR,\n      quilt: config,\n    })\n\n    this.scene.add(this.spatialPlayer)\n\n    let dist = this.camera.position.z - this.spatialPlayer.position.z;\n    let height = this.aspectRatio; // desired height to fit WHY IS THIS CALLED HEIGHT?\n    this.camera.fov = Math.atan(height / dist) * (180 / Math.PI);\n    this.camera.updateProjectionMatrix();\n\n    console.log(this.spatialPlayer)\n  }\n\n  private async loadGawdConfig(url: string): Promise<any> {\n    const response = await fetch(url)\n    return await response.json()\n  }\n\n  private setProps(viewerProps: Props, userProps?: object): void {\n    if (!userProps) return\n\n    for (let prop in userProps) {\n      if (prop in viewerProps) {\n        viewerProps[prop] = userProps[prop]\n      } else {\n        console.warn(\n          `GawdViewer: Provided ${prop} in config but it is not a valid property and will be ignored`,\n        )\n      }\n    }\n  }\n\n  public get aspectRatio(): number {\n    return this.props.container.clientWidth / this.props.container.clientHeight\n  }\n}\n"],"names":["Props","url","container","Player","constructor","props","scene","renderer","spatialPlayer","camera","setProps","initThree","console","warn","loadGawdConfig","then","data","initGawd","Scene","WebGLRenderer","antialias","setSize","clientWidth","clientHeight","xr","enabled","appendChild","domElement","PerspectiveCamera","aspectRatio","position","add","z","setAnimationLoop","render","window","addEventListener","ev","aspect","updateProjectionMatrix","onMouseMove","bind","e","totalAngles","quiltColumns","quiltRows","xpos","clientX","innerWidth","quiltAngle","Math","round","gawd","log","name","lkgAssets","assets","filter","a","spatial","initMedia","asset","contentType","loader","TextureLoader","load","tex","loadSpatialPlayer","texture","config","QuiltConfig","columns","quilt","rows","width","viewSize","height","SpatialPlayer","spatialType","SpatialType","LOOKING_GLASS","stereoMode","StereoMode","COLOR","dist","fov","atan","PI","response","fetch","json","viewerProps","userProps","prop"],"mappings":"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"}